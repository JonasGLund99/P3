@using src.Data
@using src.Shared

<div class="heatmap-component">
    <div id="toolbar">
        <div id="export-icon" title="Export overview">
            <i class="fa-solid fa-file-export"></i>
        </div>
    </div>
    <div class="heatmap-and-scale">
        <div class="all-heatmap-cells">
            <table class ="heatmap-table">
                <thead>
                    <tr class="heatmap-header">
                        @{int j = 1;}
                        @foreach (string chosenTableTitle in ClinicalTest.ChosenTableTitles)
                        {
                            if (chosenTableTitle != null) {
                                <th id="key-number-@j">@chosenTableTitle</th>
                                j++;
                            }       
                        }
                        @foreach (string analyteName in ClinicalTest.AnalyteNames) 
                        {
                            <th>@analyteName</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @{int i = 0;}
                    @foreach(Slide slide in slides)
                    {
                        @foreach(Block block in slide.Blocks) {
                            <tr>
                                @{int k = 1;}
                                @foreach (string chosenTableTitle in ClinicalTest.ChosenTableTitles)
                                {
                                    if (chosenTableTitle != null)
                                    {
                                        <td class="key-number-@k">@block.PatientData[ClinicalTest.TableTitles.IndexOf(chosenTableTitle)]</td>
                                        k++;
                                    }
                                }
                                @foreach (Nplicate nplicate in block.Nplicates) 
                                {
                                    <td class="flagged-@nplicate.IsFlagged.ToString().ToLower()" style="background-color: @System.Drawing.ColorTranslator.ToHtml(nplicate.HeatmapColour);"></td>
                                }
                            </tr>    
                        }
                        i++;
                    }
                </tbody>
            </table>
        </div>
        <div class="color-scale-indicator">
            <i class="fa-solid fa-file-export"></i>
        </div>
    </div>
</div>

@code {

    private List<Slide> slides { 
        get 
        {
            return ClinicalTest.GetSlides();
        }
    }

    [Parameter]
    public ClinicalTest ClinicalTest { get; set; }


}
